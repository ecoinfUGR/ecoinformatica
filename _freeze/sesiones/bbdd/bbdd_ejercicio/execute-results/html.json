{
  "hash": "457eb375944a13ab15574b763656fcf9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ejercicio de bases de datos\"\nformat: html\nauthor: \n  - name: \"María Suárez Muñoz\"\n    orcid: 0000-0003-1765-6885\n    email: bv2sumum@uco.es\n    affiliation: Departamento de Ingeniería Forestal, Universidad de Córdoba\ndate: 2025-02-03\nsesion: 2\ncrossref:\n  fig-title: Figura     # (default is \"Figure\")\n  tbl-title: Tabla     # (default is \"Table\")\n  title-delim: .     # (default is \":\")\n  fig-prefix: Figura\n  tbl-prefix: Tabla\n  ref-hyperlink: true\n  sec-prefix: \"\"\n  sec-labels: alpha\n---\n\n\n# Introducción {.unnumbered}\n\n- En este ejercicio aprenderemos a trabajar con bases de datos desde `R`.\n\n- Vamos a trabajar con [R](https://www.r-project.org/), Rstudio (ahora llamado [posit](https://posit.co/)), y utilizaremos al menos los paquete [`RSQLite`](https://rsqlite.r-dbi.org/) y [`dplyr`](https://dplyr.tidyverse.org/).\n\n# Flujo de Trabajo\n\n1. Instalar y cargar paquetes\n2. Crear conexión con base de datos\n3. Montar base de datos\n4. Realizar consultas\n5. Cerrar base de datos\n\n## Instalar y cargar paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"RSQLite\")\nlibrary(RSQLite)\n# install.packages(\"dplyr\")\nlibrary(dplyr)\n\npath <- \"sesiones/bbdd/material/\"\n```\n:::\n\n\n## Crear conexión con base de datos\n\n::: {.cell}\n\n```{.r .cell-code}\ncon = dbConnect(RSQLite::SQLite(), dbname = paste0(path, \"sql.sqlite\"))\ndbListTables(con)\n```\n:::\n\n\n## Montar base de datos\n\n::: {.cell}\n\n```{.r .cell-code}\nparcelas <- read.table(paste0(path, \"ifn3p18_Convertida_Tabla_PCParcelas.txt\"), sep = \";\", header = TRUE)\nmayores <- read.table(paste0(path, \"ifn3p18_Convertida_Tabla_PCMayores.txt\"), sep = \";\", header = TRUE)\nmatorral <- read.table(paste0(path, \"ifn3p18_Convertida_Tabla_PCMatorral.txt\"), sep = \";\", header = TRUE)\nregenera <- read.table(paste0(path, \"ifn3p18_Convertida_Tabla_PCRegenera.txt\"), sep = \";\", header = TRUE)\narboles <- read.table(paste0(path, \"especies_ANEXO12.txt\"), sep = \";\", header = TRUE)\narbustos <- read.table(paste0(path, \"especies_ANEXO13.txt\"), sep = \";\", header = TRUE)\n\ndbWriteTable(con, \"parcelas\", parcelas)\ndbWriteTable(con, \"mayores\", mayores)\ndbWriteTable(con, \"matorral\", matorral)\ndbWriteTable(con, \"regenera\", regenera)\ndbWriteTable(con, \"arboles\", arboles)\ndbWriteTable(con, \"arbustos\", arbustos)\n\ndbListTables(con)\ndbListFields(con, \"parcelas\")\ndbReadTable(con, \"parcelas\")\n```\n:::\n\n\n## Realizar consultas\n\nPodemos realizar consultas sencillas con SQL. Por ejemplo, quiero extraer el diámetro medio de todas las encinas muestreadas, y el estadillo al que pertenecen.\n\n::: {.cell}\n\n```{.r .cell-code}\nquery_1 <- dbSendQuery(con, \"SELECT Estadillo, Especie, (Dn1 + Dn2/2) AS Dn_avg\n                             FROM mayores\n                             WHERE Dn_avg > 84\")\ndf_q1 <- dbFetch(query_1)\ndbClearResult(query_1)\n```\n:::\n\n\nO quiero conocer cuál es el diámetro medio de los pinos carrasco. \n\n::: {.cell}\n\n```{.r .cell-code}\nquery_2 <- dbSendQuery(con, \"SELECT Estadillo, (Dn1 + Dn2/2) AS Dn_avg\n                             FROM mayores\n                             WHERE Especie = 24;\")\ndf_q2 <- dbFetch(query_2)\n```\n:::\n\n\nY consultas más complejas. Por ejemplo, quiero conocer cuáles son las especies acompañantes a las encinas adultas en cada parcela...\n\n## Realizar consultas sin usar lenguaje SQL\n\nAunque la lógica del SQL sigue aplicando, existen otras formas de tratar nuestros datos como bases de datos, con paquetes que resultan mucho más amigables...\n\nPor ejemplo, si de nuevo quiero conocer cuáles son las especies acompañantes a las encinas adultas en cada parcela...\n \n\n::: {.cell}\n\n```{.r .cell-code}\nacompanantes <- mayores %>%\n  left_join(arboles, by = c(\"Especie\" = \"Codigo\")) %>%\n  filter(Especie.y == \"Quercus ilex\") %>%\n  select(Estadillo, Cla, Subclase) %>%\n  distinct() %>%\n  left_join(matorral, by = c(\"Estadillo\" = \"Estadillo\", \"Cla\" = \"Cla\", \"Subclase\" = \"Subclase\")) %>%\n  select(-Fcc, -Hm) %>%\n  left_join(arbustos, by = c(\"Especie\" = \"Codigo\")) %>%\n  rename(Codigo = Especie, Especie = Especie.y)\n```\n:::\n\n\n## Cerrar base de datos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndbDisconnect(con)\n```\n:::\n",
    "supporting": [
      "bbdd_ejercicio_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}