<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="María Suárez Muñoz">
<meta name="dcterms.date" content="2025-01-07">

<title>Ciclo de Gestión de los Datos. Ecoinformática - Manual de Sistemas de Información Geográfica</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ciclo de Gestión de los Datos. Ecoinformática</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="https://github.com/ecoinfugr/" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Manual de Sistemas de Información Geográfica</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../calendario.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calendario</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../modulos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Módulos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../equipo/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Profesores</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../guia_docente.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guía Docente</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción">Introducción</a></li>
  <li><a href="#flujo-de-trabajo" id="toc-flujo-de-trabajo" class="nav-link" data-scroll-target="#flujo-de-trabajo">Flujo de Trabajo</a>
  <ul class="collapse">
  <li><a href="#crear-un-proyecto-qgis" id="toc-crear-un-proyecto-qgis" class="nav-link" data-scroll-target="#crear-un-proyecto-qgis">Crear un proyecto <code>qGIS</code></a></li>
  <li><a href="#configurar-sistema-de-referencia" id="toc-configurar-sistema-de-referencia" class="nav-link" data-scroll-target="#configurar-sistema-de-referencia">Configurar sistema de referencia</a></li>
  <li><a href="#cargar-capas" id="toc-cargar-capas" class="nav-link" data-scroll-target="#cargar-capas">Cargar capas</a>
  <ul class="collapse">
  <li><a href="#cargar-capas-vectoriales" id="toc-cargar-capas-vectoriales" class="nav-link" data-scroll-target="#cargar-capas-vectoriales">Cargar capas vectoriales</a></li>
  <li><a href="#cargar-capas-ráster" id="toc-cargar-capas-ráster" class="nav-link" data-scroll-target="#cargar-capas-ráster">Cargar capas ráster</a></li>
  <li><a href="#cargar-capas-wms" id="toc-cargar-capas-wms" class="nav-link" data-scroll-target="#cargar-capas-wms">Cargar capas WMS</a></li>
  <li><a href="#modificar-simbología-de-las-capas" id="toc-modificar-simbología-de-las-capas" class="nav-link" data-scroll-target="#modificar-simbología-de-las-capas">Modificar simbología de las capas</a></li>
  <li><a href="#crear-capa-vectorial-puntos" id="toc-crear-capa-vectorial-puntos" class="nav-link" data-scroll-target="#crear-capa-vectorial-puntos">Crear capa vectorial (puntos)</a></li>
  <li><a href="#crear-capa-vectorial-polígonos" id="toc-crear-capa-vectorial-polígonos" class="nav-link" data-scroll-target="#crear-capa-vectorial-polígonos">Crear capa vectorial (polígonos)</a></li>
  </ul></li>
  <li><a href="#realizar-operaciones" id="toc-realizar-operaciones" class="nav-link" data-scroll-target="#realizar-operaciones">Realizar operaciones</a>
  <ul class="collapse">
  <li><a href="#calcular-geometrías" id="toc-calcular-geometrías" class="nav-link" data-scroll-target="#calcular-geometrías">Calcular geometrías</a></li>
  <li><a href="#calcular-pendiente-y-aspecto" id="toc-calcular-pendiente-y-aspecto" class="nav-link" data-scroll-target="#calcular-pendiente-y-aspecto">Calcular pendiente y aspecto</a></li>
  <li><a href="#seleccionar-elementos-vectoriales" id="toc-seleccionar-elementos-vectoriales" class="nav-link" data-scroll-target="#seleccionar-elementos-vectoriales">Seleccionar elementos vectoriales</a></li>
  <li><a href="#buffer" id="toc-buffer" class="nav-link" data-scroll-target="#buffer">Buffer</a></li>
  <li><a href="#cálculos-aritméticos-con-capas-ráster" id="toc-cálculos-aritméticos-con-capas-ráster" class="nav-link" data-scroll-target="#cálculos-aritméticos-con-capas-ráster">Cálculos aritméticos con capas ráster</a></li>
  <li><a href="#reproyectar-capas" id="toc-reproyectar-capas" class="nav-link" data-scroll-target="#reproyectar-capas">Reproyectar capas</a></li>
  <li><a href="#recortar-ráster" id="toc-recortar-ráster" class="nav-link" data-scroll-target="#recortar-ráster">Recortar ráster</a></li>
  <li><a href="#crear-máscara-con-capa-ráster" id="toc-crear-máscara-con-capa-ráster" class="nav-link" data-scroll-target="#crear-máscara-con-capa-ráster">Crear máscara con capa ráster</a></li>
  <li><a href="#comprobar-validez-de-las-geometrías" id="toc-comprobar-validez-de-las-geometrías" class="nav-link" data-scroll-target="#comprobar-validez-de-las-geometrías">Comprobar validez de las geometrías</a></li>
  <li><a href="#descargar-info-de-la-rediam---hasta-aquí" id="toc-descargar-info-de-la-rediam---hasta-aquí" class="nav-link" data-scroll-target="#descargar-info-de-la-rediam---hasta-aquí">Descargar info de la REDIAM - HASTA AQUÍ</a></li>
  <li><a href="#vincular-información-a-una-capa" id="toc-vincular-información-a-una-capa" class="nav-link" data-scroll-target="#vincular-información-a-una-capa">Vincular información a una capa</a></li>
  <li><a href="#alinear-capas-ráster" id="toc-alinear-capas-ráster" class="nav-link" data-scroll-target="#alinear-capas-ráster">Alinear capas ráster</a></li>
  <li><a href="#rasterizar" id="toc-rasterizar" class="nav-link" data-scroll-target="#rasterizar">Rasterizar</a></li>
  <li><a href="#poligonizar" id="toc-poligonizar" class="nav-link" data-scroll-target="#poligonizar">Poligonizar</a></li>
  <li><a href="#difference-dissolve-union" id="toc-difference-dissolve-union" class="nav-link" data-scroll-target="#difference-dissolve-union">Difference / Dissolve / Union</a></li>
  </ul></li>
  <li><a href="#crear-mapa" id="toc-crear-mapa" class="nav-link" data-scroll-target="#crear-mapa">Crear mapa</a></li>
  <li><a href="#guardar-proyecto" id="toc-guardar-proyecto" class="nav-link" data-scroll-target="#guardar-proyecto">Guardar proyecto</a></li>
  <li><a href="#abrir-proyecto" id="toc-abrir-proyecto" class="nav-link" data-scroll-target="#abrir-proyecto">Abrir proyecto</a></li>
  <li><a href="#capas-necesarias-para-la-práctica-con-r" id="toc-capas-necesarias-para-la-práctica-con-r" class="nav-link" data-scroll-target="#capas-necesarias-para-la-práctica-con-r">Capas necesarias para la práctica con <code>R</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Manual de Sistemas de Información Geográfica</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">María Suárez Muñoz <a href="mailto:maria.suarez.munoz@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-1765-6885" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Departamento de Ingeniería Forestal, Universidad de Córdoba
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introducción" class="level1 unnumbered">
<h1 class="unnumbered">Introducción</h1>
<ul>
<li><p>En este tutorial vamos a aprender a manejar información espacial, realizando diversas operaciones con Sistemas de Información Geográfica.</p></li>
<li><p>Vamos a trabajar con <a href="https://qgis.org/">qGIS</a>.</p></li>
</ul>
<hr>
</section>
<section id="flujo-de-trabajo" class="level1">
<h1>Flujo de Trabajo</h1>
<ol type="1">
<li>Crear proyecto <code>qGIS</code></li>
<li>Configurar sistema de referencia</li>
<li>Cargar capas</li>
<li>Realizar operaciones</li>
<li>Crear mapa</li>
<li>Guardar proyecto</li>
<li>Abrir proyecto</li>
</ol>
<p><img src="images/gis_workflow.png" class="img-fluid"></p>
<section id="crear-un-proyecto-qgis" class="level2">
<h2 class="anchored" data-anchor-id="crear-un-proyecto-qgis">Crear un proyecto <code>qGIS</code></h2>
<p>Dentro de <code>qGIS</code>, haz clic en <strong>Project → New</strong></p>
<p><img src="images/gis_create_project.png" class="img-fluid"></p>
</section>
<section id="configurar-sistema-de-referencia" class="level2">
<h2 class="anchored" data-anchor-id="configurar-sistema-de-referencia">Configurar sistema de referencia</h2>
<p>Al configurar el sistema de referencia del proyecto estamos diciéndole a qGIS que trabajaremos en este sistema. En este proyecto trabajaremos con el sistema de referencia EPSG 23030.</p>
<p><img src="images/gis_config_coord_system.png" class="img-fluid"></p>
</section>
<section id="cargar-capas" class="level2">
<h2 class="anchored" data-anchor-id="cargar-capas">Cargar capas</h2>
<section id="cargar-capas-vectoriales" class="level3">
<h3 class="anchored" data-anchor-id="cargar-capas-vectoriales">Cargar capas vectoriales</h3>
<p>La información vectorial puede almacenarse en distintos tipos de archivos. Algunos de los más comunes son los archivos shape y GeoPackage. La diferencia entre ellos es que en los archivos shape el formato de los archivos es privado, mientras que en los GeoPackage son datos abiertos. Además, los archivos shape en realidad se componen de un conjunto de archivos (.shp, .cpg, .dbf, .prj, .shx) que deben ir juntos y con el mismo nombre para ser leídos correctamente. Por su parte, los archivos GeoPackage contienen toda la información en un sólo archivo (.gpkg).</p>
<p>Cargaremos las capas vectoriales <em>red_viaria.shp</em>, <em>incendio_lanjaron_perimetro_23030.shp</em> y <em>mucva_multi_23030.gpkg</em>.</p>
<p><img src="images/load_vect_layer.png" class="img-fluid"></p>
<p>Estas capas contienen información sobre la red de carreteras, la zona afectada por el incendio y la vegetación existente en la zona. En las capas vectoriales la información está almacenada en los atributos de cada uno de los elementos de la capa. Para verlos: <strong>Botón derecho sobre la capa → Open Attribute Table</strong></p>
</section>
<section id="cargar-capas-ráster" class="level3">
<h3 class="anchored" data-anchor-id="cargar-capas-ráster">Cargar capas ráster</h3>
<p>Ahora cargaremos una con información en rejilla (capa ráster). Los más habitual es que las capas ráster estén compuestas por celdas cuadradas, cada una de ellas con un valor numérico asignado. Pero también existen capas ráster con celdas no cuadradas (por ejemplo, hexagonales) y con información no numérica (por ejemplo, combinando archivos donde los valores numéricos de la capa se relacionan con una leyendas que aporta información adicional).</p>
<p>Como en el caso de los archivos vectoriales, para las capas ráster también existen distintos formatos (.asc, .tif o los algo antiguos .adf). En este caso cargaremos las capas correspondientes a la elevación (<em>modelo_digital_elevaciones.asc</em>) y profundidad de suelo (<em>prof_suelos.tif</em>).</p>
<p>Podéis encontrar una lista exhaustiva de formatos ráster en este (enlace)[http://www.gdal.org/formats_list.html] de la librería GDAL.</p>
<p><img src="images/load_raster_layer.png" class="img-fluid"></p>
<p>Las dos capas que hemos cargado tienen una diferencia fundamental, y es que una corresponde a una variable continua (la elevación), mientras que la otra representa una variable discreta (una clasificación de la profundidad del suelo en 4 clases). Esto es importante, ya que determina qué tipo de operaciones podremos realizar con ellas.</p>
</section>
<section id="cargar-capas-wms" class="level3">
<h3 class="anchored" data-anchor-id="cargar-capas-wms">Cargar capas WMS</h3>
<p>Las capas WMS (Web Map Service) son capas de información espacial que obtenemos de un servidor web que nos permite acceder a ellas y visualizarlas en nuestra aplicación SIG. Para acceder a ellas debemos facilitar a <code>qGIS</code> la URL en la que están alojadas.</p>
<p>En este proyecto pueden ser útiles las capas WMS con la ortofoto del PNOA de máxima actualidad (URL: <em>http://www.ign.es/wms-inspire/pnoa-ma</em>) o la ortofoto del incendio (URL: <em>https://www.juntadeandalucia.es/medioambiente/mapwms/REDIAM_Ortofoto_Lanjaron_RGB_2005?</em>).</p>
<p>Para crear la conexión al servidor: <strong>Add WMS/WMTS Layer… → New</strong></p>
<p>Para cargar la capa: <strong>Add WMS/WMTS Layer… → Seleccionar capa → Connect → Seleccionar subcapa → Add</strong></p>
<p>Existen multitud de fuentes de información espacial que ofrecen capas WMS. En el contexto de Andalucía una buena fuente es la Red de Información Ambiental de Andalucía (REDIAM), que además tiene un <a href="https://portalrediam.cica.es/VisorRediam/">visor web</a> que permite explorar las capas disponibles.</p>
</section>
<section id="modificar-simbología-de-las-capas" class="level3">
<h3 class="anchored" data-anchor-id="modificar-simbología-de-las-capas">Modificar simbología de las capas</h3>
<p>Al cargar una capa en <code>qGIS</code> el programa la representa considerando el tipo de capa que es. Sin embargo, podemos modificar esta simbología con multitud de opciones. Para ello accederemos a la opción <strong>Symbology</strong> haciendo doble click sobre la capa correspondiente.</p>
<p>Veremos cómo las opciones de simbología son diferentes según el tipo de capa:</p>
<p><img src="images/symbology_vect_1.png" class="img-fluid"></p>
<p><img src="images/symbology_vect_2.png" class="img-fluid"></p>
<p><img src="images/symbology_raster.png" class="img-fluid"></p>
<p><img src="images/symbology_wms.png" class="img-fluid"></p>
</section>
<section id="crear-capa-vectorial-puntos" class="level3">
<h3 class="anchored" data-anchor-id="crear-capa-vectorial-puntos">Crear capa vectorial (puntos)</h3>
<p><code>qGIS</code> nos permite cargar información a partir de archivos de texto:</p>
<p><img src="images/load_csv.png" class="img-fluid"></p>
<p>Esto es muy práctico en el caso habitual en el que tenemos una lista de puntos con sus coordenadas, como es el caso de la lista de parcelas del Inventario Forestal Nacional (<em>ifn3_plot_coords_23030.csv</em>), del que hablaremos más adelante.</p>
<p>Así, podemos crear una capa vectorial a partir de este tipo de archivos:</p>
<p><img src="images/load_point_coords.png" class="img-fluid"></p>
<p>Esta capa, sin embargo, no existe fuera de nuestro proyecto de <code>qGIS</code>. Si queremos guardarla como tal necesitaremos exportarla: <strong>Export → Save Features As…</strong></p>
</section>
<section id="crear-capa-vectorial-polígonos" class="level3">
<h3 class="anchored" data-anchor-id="crear-capa-vectorial-polígonos">Crear capa vectorial (polígonos)</h3>
<p>También podemos crear capas de manera manual. En este caso, nos será útil crear una capa con un polígono que contenga el área del incendio, a la que llamaremos <em>area_trabajo_23030.shp</em>. Para ello: <strong>New Shapefile Layer…</strong></p>
<p><img src="images/new_shapefile_layer.png" class="img-fluid"></p>
<p><img src="images/draw_shapefile_layer.png" class="img-fluid"></p>
<p>También podríamos crear capas de puntos y de líneas con las opciones correspondientes a este tipo de elementos.</p>
</section>
</section>
<section id="realizar-operaciones" class="level2">
<h2 class="anchored" data-anchor-id="realizar-operaciones">Realizar operaciones</h2>
<p>Una vez cargadas y creadas algunas de las capas con las que vamos trabajar podemos empezar a realizar operaciones con ellas. <code>qGIS</code> tiene algunas operaciones incorporadas de manera general a sus opciones. Además, para incorporar funcionalidades adicionales, <code>qGIS</code> ofrece una serie de plug-ins, está integrado con otros SIG como GDAL, GRASS o SAGA y permite realizar análisis con Python directamente desde la interfaz de <code>qGIS</code>. En este tutorial veremos algunas de estas funcionalidades, pero las opciones son casi infinitas, así que cuando quieras hacer algo y no sepas cómo, ¡pregunta! (a mí, a almas caritativas en foros sobre SIG y programación, a tu buscador de confianza, a tu IA favorita…).</p>
<section id="calcular-geometrías" class="level3">
<h3 class="anchored" data-anchor-id="calcular-geometrías">Calcular geometrías</h3>
<p>Una operación básica al trabajar con capas vectoriales es el cálculo de sus geometrías: <strong>Vector → Geometry Tools → Add Geometry Attributes…</strong></p>
<p>El cálculo de geometrías sobre distinto tipo de capas vectoriales nos reporta distintos atributos, ¿por qué?</p>
<p>¿Cuál fue la superficie del incendio?</p>
<p><strong>CUIDADO</strong> una vez calculadas las geometrías de una capa éstas se incorporan a los atributos de la capa y a partir de entonces <code>qGIS</code> <em>se olvida</em> de lo que son. Es decir, pasan a ser un atributo estátito de cada elemento y si realizamos operaciones con esa capa que arrastren esos atributos éstos no se actualizarán.</p>
</section>
<section id="calcular-pendiente-y-aspecto" class="level3">
<h3 class="anchored" data-anchor-id="calcular-pendiente-y-aspecto">Calcular pendiente y aspecto</h3>
<p>Por su parte, algunas operaciones básicas al trabajar con capas de elevación son el cálculo la pendiente (<strong>Raster → Analysis → Slope…</strong>) y el aspecto (<strong>Raster → Analysis → Aspect…</strong>), que aporta la integración de <code>qGIS</code> y GDAL.</p>
</section>
<section id="seleccionar-elementos-vectoriales" class="level3">
<h3 class="anchored" data-anchor-id="seleccionar-elementos-vectoriales">Seleccionar elementos vectoriales</h3>
<p>En algunas ocasiones nos interesa seleccionar un subconjunto de elementos de una capa vectorial (puntos dentro de un polígono, líneas o polígonos dentro de un polígono mayor…). Para podemos realizar una selección manual con distintas opciones (<strong>Select Feature(s)</strong>, <strong>Select Features by Polygon</strong>, <strong>Select Features by Freehand</strong>, <strong>Select Features by Radius</strong>).</p>
<p>También podemos utilizar un polígono ya existente, como es el caso de nuestra <em>area_trabajo_23030.shp</em>: <strong>Vector → Geoprocessing Tools → Intersection…</strong> o <strong>Vector → Geoprocessing Tools → Clip…</strong>. ¿Cuál sería la diferencia?</p>
<p><img src="images/vector_intersection.png" class="img-fluid"></p>
<p>De la misma manera podríamos generar una capa con la red de carretera que se ha visto afectada por el incendio, y que constituyen las principales vías de acceso a la zona.</p>
</section>
<section id="buffer" class="level3">
<h3 class="anchored" data-anchor-id="buffer">Buffer</h3>
<p>Para distintos procesos nos puede resultar interesante definir unas franjas de cierta anchura a ambos lados de los caminos y carreteras (por ejemplo, para realizar actuaciones de eliminación de materia muerta para disminuir el riesgo de futuros incendios). Esto es lo que se conoce como “buffer”, y puede aplicarse sobre elementos lineales, pero también sobre puntos y polígonos (pensemos, por ejemplo, en la distancia a la que esperamos encontrar ciertas desde árboles individuales o parches de vegetación).</p>
<p>En este caso vamos a realizar un buffer sobre la red de carreteras afectadas por el fuego. Para ello primero necesitaremos recortar la capa de red viaria con el polígono del incendio (ver <strong>Intersection</strong>) y a continuación aplicar la herramienta buffer (<strong>Vector → Geoprocessing Tools → Buffer</strong>).</p>
<p>Con lo que hemos aprendido hasta ahora, imagina que tienes que diseñar una actuación sobre la zona afectada por el incendio. La actuación corresponde a la realización de (rozas)[https://diccionario.raing.es/es/lema/roza-1]. Queremos realizarlas sobre el regenerado pasados unos años tras el incendio, con el objetivo de reducir el riesgo de aparición nuevos incendios. ¿Sabrías decirme cuál será la superficie sobre la que actuar si queremos realizar rozas en toda la superficie que se encuentra a menos de 50 m de caminos?</p>
</section>
<section id="cálculos-aritméticos-con-capas-ráster" class="level3">
<h3 class="anchored" data-anchor-id="cálculos-aritméticos-con-capas-ráster">Cálculos aritméticos con capas ráster</h3>
<p>Las capas ráster tienen la ventaja de que al representar información numérica resulta muy sencillo calcular nuevas capas a partir de ellas aplicando operaciones aritméticas. Para ello <code>qGIS</code>cuenta con la calculadora de rásters (<strong>Raster → Raster Calculator…</strong>) que nos permite combinar capas ráster mediante operaciones matemáticas.</p>
<p>Ejemplo de estas operaciones puede ser calcular una capa con la temperatura media de nuestra zona considerando las temperaturas máximas y mínimas (<em>tmax_1971_2000_3042.tif</em>, <em>tmin_1971_2000_3042.tif</em>):</p>
<p><img src="images/calculate_temp_mean.png" class="img-fluid"></p>
<p><em>Nota:</em> Si cargamos una capa que está en un sistema de referencia distinto al de nuestro proyecto, qGIS reproyectará esa capa <em>al vuelo</em> (a veces sin avisarnos) para visualizarla correctamente en el sistema de referencia del proyecto. Esto facilita la visualización, pero para realizar operaciones con distintas capas es más adecuado asegurarnos de que todas las capas estén en el mismo sistema antes de realizar operaciones sobre ellas (ver más abajo).</p>
<p>O todo tipo de índices, como por ejemplo el índice de aridez de De Martonne (M):</p>
<p>I_DM = Precipitación anual acumulada / (Temperatura media + 10)</p>
<p>Este índice nos da una idea de la aridez del clima de un territorio. Los valores por debajo de 10 indicarían un clima muy árido, mientras que valores entre 20-24 corresponderían al clima mediterráneo y por encima de 55 estaríamos hablando de climas muy húmedos.</p>
<p>En nuestro caso vemos cómo existe un gradiente muy acusado en los valores de este índice en el área que rodea al incendio. Para ver la distribución de los valores también podemos crear un histograma.</p>
<p><img src="images/raster_histogram.png" class="img-fluid"></p>
<p>¿A qué puede deberse esta distribución?</p>
</section>
<section id="reproyectar-capas" class="level3">
<h3 class="anchored" data-anchor-id="reproyectar-capas">Reproyectar capas</h3>
<p>Como hemos comentado, cuando vamos a operar sobre capas que no están en el sistema de coordenadas en el que estamos trabajando es más adecuado <em>reproyectarlas</em> al sistema correspondiente, sobre todo si vamos a combinar capas que están en distintos sistemas. Para ello podemos reproyectar la capa con: <strong>Botón derecho sobre la capa → Export → Save As…</strong>.</p>
<p>Aunque visualmente no veremos diferencia debido a la reproyección <em>al vuelo</em> que aplica <code>qGIS</code>, podemos ver la diferencia en la información de la capa <strong>Botón derecho sobre la capa → Information</strong>.</p>
</section>
<section id="recortar-ráster" class="level3">
<h3 class="anchored" data-anchor-id="recortar-ráster">Recortar ráster</h3>
<p>Cuando necesitamos recortar una capa ráster podemos hacerlo de varias maneras: podemos recortar una capa dando las coordenadas de los vértices del recuadro que queremos extraer o a partir de otra capa - vectorial o ráster - que tenga la extensión que nos interesa. La <em>extensión</em> es la superficie ocupada por una capa, que viene dada por las coordenadas de sus vértices (xmin, xmax, ymin, ymax). Para esto haremos: <strong>Raster → Extraction → Clip Raster by Extent</strong></p>
<p><strong>Ojo</strong> la extensión no tiene por qué corresponder con la superficie que visualizamos: un ráster puede tener celdas sin valor que computarán dentro de su extensión y la extensión de una capa vectorial se corresponderá con el recuadro formado por sus coordenadas máximas y mínimas, no por el mínimo polígono que contenga todos sus elementos.</p>
<p>Otra opción es utilizar una capa vectorial (de polígono) como máscara. En este caso sí extraeremos sólo la porción del ráster contenida dentro del polígono, y no la correspondiente a su extensión. Para esto haremos: <strong>Raster → Extraction → Clip Raster by Mask Layer</strong></p>
</section>
<section id="crear-máscara-con-capa-ráster" class="level3">
<h3 class="anchored" data-anchor-id="crear-máscara-con-capa-ráster">Crear máscara con capa ráster</h3>
<p>El concepto de máscara es muy útil para distintos procesos con capas espaciales. En el paso anterior hemos visto cómo utilizar aplicar una máscara a partir de una capa vectorial. Pero en otros casos puede sernos útil tener a mano una máscara en formato ráster. Para crearla podemos utilizar la calculadora de rásters que ya utilizamos antes:</p>
<p><img src="images/raster_mask.png" class="img-fluid"></p>
<p>Así (por ejemplo, habría otras formas de hacerlo) obtenemos un ráster con valor 1 en las celdas con algún valor en la capa <em>clipped_raster</em>.</p>
</section>
<section id="comprobar-validez-de-las-geometrías" class="level3">
<h3 class="anchored" data-anchor-id="comprobar-validez-de-las-geometrías">Comprobar validez de las geometrías</h3>
<p>En ocasiones aparecen errores al intentar realizar operaciones con capas vectoriales, a menudo debido a pequeños fallos en la geometría de algún polígono. El error suele tener esta pinta:</p>
<p><img src="images/error_validity.png" class="img-fluid"></p>
<p>Encontrar el error puede ser complicado cuando se trata de capas con muchos polígonos. Para facilitarlo podemos comprovar la validez de la geometría de una capa (<strong>Vector → Geometry Tools → Check Validity…</strong>), obteniendo capas resultantes que identifican dónde está el problema:</p>
<p><img src="images/validity_output.png" class="img-fluid"></p>
<p>La causa de los errores puede ser diversa y, por tanto, la solución puede depender en cada caso, pero al menos ya tenemos ubicado el problema ;)</p>
</section>
<section id="descargar-info-de-la-rediam---hasta-aquí" class="level3">
<h3 class="anchored" data-anchor-id="descargar-info-de-la-rediam---hasta-aquí">Descargar info de la REDIAM - HASTA AQUÍ</h3>
<p>A menudo necesitamos capas de información que no podemos generar nosotros mismos, sino que las des</p>
<p>https://portalrediam.cica.es/descargas Al menos: incidencia, temperaturas y precipitaciones</p>
</section>
<section id="vincular-información-a-una-capa" class="level3">
<h3 class="anchored" data-anchor-id="vincular-información-a-una-capa">Vincular información a una capa</h3>
<p>Archivo texto + archivo vectorial (Joins) Pre-intro a BBDD</p>
</section>
<section id="alinear-capas-ráster" class="level3">
<h3 class="anchored" data-anchor-id="alinear-capas-ráster">Alinear capas ráster</h3>
<p>Explicar problemas de alineamiento - qGIS no lo menciona!</p>
</section>
<section id="rasterizar" class="level3">
<h3 class="anchored" data-anchor-id="rasterizar">Rasterizar</h3>
</section>
<section id="poligonizar" class="level3">
<h3 class="anchored" data-anchor-id="poligonizar">Poligonizar</h3>
</section>
<section id="difference-dissolve-union" class="level3">
<h3 class="anchored" data-anchor-id="difference-dissolve-union">Difference / Dissolve / Union</h3>
</section>
</section>
<section id="crear-mapa" class="level2">
<h2 class="anchored" data-anchor-id="crear-mapa">Crear mapa</h2>
<p>Para crear un mapa exportable a pdf u otro formato primero necesitaremos crear un diseño (<strong>Project → New Print Layout…</strong>). Una vez creado accedemos a él y podemos empezar a añadir elementos:</p>
<p><img src="images/create_map.png" class="img-fluid"></p>
</section>
<section id="guardar-proyecto" class="level2">
<h2 class="anchored" data-anchor-id="guardar-proyecto">Guardar proyecto</h2>
<p><img src="images/gis_save_project.png" class="img-fluid"></p>
</section>
<section id="abrir-proyecto" class="level2">
<h2 class="anchored" data-anchor-id="abrir-proyecto">Abrir proyecto</h2>
<ul>
<li>error de capas</li>
</ul>
</section>
<section id="capas-necesarias-para-la-práctica-con-r" class="level2">
<h2 class="anchored" data-anchor-id="capas-necesarias-para-la-práctica-con-r">Capas necesarias para la práctica con <code>R</code></h2>
<p>Máscara - hecho en ### Crear máscara con capa ráster Pendiente - hecho en ### Calcular pendiente y aspecto Aspecto - hecho en ### Calcular pendiente y aspecto Incidencia - descargar (### Descargar info de la REDIAM) y recortar (### Recortar ráster) Aridez - hecho en ### Cálculos aritméticos con capas ráster Temperaturas - descargar (### Descargar info de la REDIAM) Precipitaciones - descargar (### Descargar info de la REDIAM) Algo de vegetación - Calcular superficie quemada de distintas coberturas (cargar mapa de vegetación, recortar, …)</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>